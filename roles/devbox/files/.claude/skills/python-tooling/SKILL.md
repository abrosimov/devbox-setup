---
name: python-tooling
description: >
  Python project tooling with uv, poetry, pip. Use when discussing project setup,
  package management, pyproject.toml, virtual environments, or development tools.
  Triggers on: uv, poetry, pip, pyproject.toml, requirements.txt, virtual environment,
  venv, project setup, new project, package manager.
---

# Python Tooling Reference

## Detect Project Tooling

**Before writing any code**, determine what package manager the project uses:

```bash
ls uv.lock pyproject.toml poetry.lock requirements.txt requirements-dev.txt 2>/dev/null
```

| Files Found | Project Uses | Your Commands |
|-------------|--------------|---------------|
| `uv.lock` | uv | `uv add`, `uv run`, `uv sync` |
| `pyproject.toml` with `[tool.uv]` | uv | `uv add`, `uv run`, `uv sync` |
| `poetry.lock` | poetry | `poetry add`, `poetry run` |
| `requirements.txt` only | pip | `pip install`, `python` |
| Nothing (new project) | **uv** | `uv init`, `uv add`, `uv run` |

**Adapt to what the project uses.** Don't mix tools.

---

## Scaffold Sequence (New Projects â€” uv)

**ALWAYS use `uv` for new Python projects. No exceptions.**

### Step 1: Initialize

```bash
# For applications (services, CLIs)
uv init my-service --package

# For libraries (reusable packages)
uv init my-library --lib
```

### Step 2: Add dependencies

```bash
# Runtime dependencies (project-specific)
uv add requests pydantic  # example

# Dev dependencies
uv add --dev pytest pytest-mock pytest-cov

# Lint dependencies
uv add --group lint ruff pylint mypy
```

### Step 3: Configure pyproject.toml

Edit the `pyproject.toml` generated by `uv init`. Add tool configuration sections from the **pyproject.toml Template** below. **Do NOT recreate the file.**

### Step 4: Create test infrastructure

```bash
mkdir -p tests
```

Create empty `tests/__init__.py` and minimal `tests/conftest.py`.

### Step 5: Verify setup

```bash
uv sync
uv run pytest
uv run mypy --strict src/
uv run ruff check .
```

**All commands must pass before the project is ready.**

### Project Type Decision

| Project Type | Init Command | Notes |
|-------------|-------------|-------|
| Standalone app / service | `uv init <name> --package` | Follow scaffold above |
| Reusable library | `uv init <name> --lib` | Follow scaffold above |
| Feature in existing monolith | Do NOT scaffold | See `python-monolith` skill |
| Feature in existing project | Do NOT scaffold | Detect tooling and adapt |

---

## pyproject.toml Template

```toml
[project]
name = "my-project"
version = "0.1.0"
description = "Brief description"
readme = "README.md"
requires-python = ">=3.11"
dependencies = []

[dependency-groups]
dev = [
    "pytest>=8.0",
    "pytest-mock>=3.12",
    "pytest-cov>=4.1",
]
lint = [
    "ruff>=0.8",
    "pylint>=3.0",
    "mypy>=1.13",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

# --- Tool Configuration ---

[tool.ruff]
line-length = 88
target-version = "py311"
src = ["src"]

[tool.ruff.lint]
select = ["E", "F", "B", "I", "UP", "C4", "SIM"]
ignore = ["E501"]  # line length handled by formatter

[tool.ruff.format]
quote-style = "double"

[tool.pylint.main]
source-roots = ["src"]
ignore-patterns = ["test_.*\\.py"]

[tool.pylint.messages_control]
disable = ["C0114", "C0115", "C0116"]  # missing docstrings

[tool.mypy]
python_version = "3.11"
strict = true
warn_return_any = true
disallow_untyped_defs = true

[[tool.mypy.overrides]]
module = ["tests.*"]
disallow_untyped_defs = false

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
addopts = "-v --strict-markers"
```
