---
name: python-tooling
description: >
  Python project tooling with uv, poetry, pip. Use when discussing project setup,
  package management, pyproject.toml, virtual environments, or development tools.
  Triggers on: uv, poetry, pip, pyproject.toml, requirements.txt, virtual environment,
  venv, project setup, new project, package manager.
---

# Python Tooling Reference

Project setup and package management for Python projects.

---

## Detect Project Tooling

**Before writing any code**, determine what package manager the project uses:

```bash
# Check for uv
ls uv.lock pyproject.toml 2>/dev/null

# Check for poetry
ls poetry.lock 2>/dev/null

# Check for pip
ls requirements.txt requirements-dev.txt 2>/dev/null
```

| Files Found | Project Uses | Your Commands |
|-------------|--------------|---------------|
| `uv.lock` | uv | `uv add`, `uv run`, `uv sync` |
| `pyproject.toml` with `[tool.uv]` | uv | `uv add`, `uv run`, `uv sync` |
| `poetry.lock` | poetry | `poetry add`, `poetry run` |
| `requirements.txt` only | pip | `pip install`, `python` |
| Nothing (new project) | **uv** | `uv init`, `uv add`, `uv run` |

**Adapt to what the project uses.** Don't mix tools.

---

## New Project Setup (uv)

**ALWAYS use `uv` for new Python projects. No exceptions.**

### FORBIDDEN in uv Projects

| FORBIDDEN | USE INSTEAD |
|-----------|-------------|
| `pip install <package>` | `uv add <package>` |
| `pip install -r requirements.txt` | `uv sync` |
| `python script.py` | `uv run python script.py` |
| `pytest` | `uv run pytest` |
| `ruff check .` (outside venv) | `uv run ruff check .` |
| Creating `pyproject.toml` via `cat`/`echo` | `uv init` |
| `python -m venv .venv` | Let uv manage automatically |
| `black src/` | `uv run ruff format src/` |

**Why:** `uv` ensures reproducible builds via lockfile. Manual pip operations bypass the lockfile. `uv` automatically creates and manages `.venv` — never create venvs manually.

### Scaffold Sequence — Step by Step

Follow these steps **in order** when creating a new Python project.

#### Step 1: Initialize

```bash
# For applications (services, CLIs)
uv init my-service --package
cd my-service

# For libraries (reusable packages)
uv init my-library --lib
cd my-library
```

This creates the base `src/` layout with `pyproject.toml`, `.python-version`, and `README.md`.

#### Step 2: Add dependencies

```bash
# Runtime dependencies (project-specific)
uv add requests pydantic  # example — add what the project needs

# Dev dependencies (testing)
uv add --dev pytest pytest-mock pytest-cov

# Lint dependencies (formatting, type checking)
uv add --group lint ruff pylint mypy
```

#### Step 3: Configure pyproject.toml

Edit the `pyproject.toml` generated by `uv init`. Add tool configuration sections from the **pyproject.toml Template** below. Key sections to add:

- `[tool.ruff]` — linter and formatter config
- `[tool.pylint]` — pylint config
- `[tool.mypy]` — type checker config
- `[tool.pytest.ini_options]` — test runner config

**Do NOT recreate the file.** Edit the existing one that `uv init` generated.

#### Step 4: Create test infrastructure

```bash
mkdir -p tests
```

Create `tests/__init__.py` (empty file) and `tests/conftest.py`:

```python
# tests/__init__.py — empty

# tests/conftest.py — minimal starter
from __future__ import annotations
```

#### Step 5: Create .gitignore (if not in existing repo)

If the project is standalone (not inside an existing repo), create `.gitignore`:

```gitignore
__pycache__/
*.py[cod]
*.egg-info/
dist/
build/
.venv/
.mypy_cache/
.pytest_cache/
.ruff_cache/
*.egg
.env
```

#### Step 6: Verify setup

```bash
# Creates .venv and uv.lock
uv sync

# Verify venv exists
ls .venv/bin/python

# Should pass with 0 tests collected
uv run pytest

# Should pass clean
uv run mypy --strict src/

# Should pass clean
uv run ruff check .
```

**All commands must pass before the project is ready.**

### Project Type Decision

| Project Type | Init Command | Structure Reference |
|-------------|-------------|---------------------|
| Standalone app / service | `uv init <name> --package` | This skill |
| Reusable library | `uv init <name> --lib` | This skill |
| Feature in existing monolith | Do NOT scaffold — follow existing patterns | `python-monolith` skill |
| Feature in existing project | Do NOT scaffold — detect tooling and adapt | Tooling detection above |

### Running Tools

```bash
# Run tests
uv run pytest

# Run linters
uv run ruff check .
uv run pylint src/
uv run mypy --strict src/

# Format code
uv run ruff format .
```

---

## pyproject.toml Template

```toml
[project]
name = "my-project"
version = "0.1.0"
description = "Brief description"
readme = "README.md"
requires-python = ">=3.11"
dependencies = []

[dependency-groups]
dev = [
    "pytest>=8.0",
    "pytest-mock>=3.12",
    "pytest-cov>=4.1",
]
lint = [
    "ruff>=0.8",
    "pylint>=3.0",
    "mypy>=1.13",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

# --- Tool Configuration ---

[tool.ruff]
line-length = 88
target-version = "py311"
src = ["src"]

[tool.ruff.lint]
select = ["E", "F", "B", "I", "UP", "C4", "SIM"]
ignore = ["E501"]  # line length handled by formatter

[tool.ruff.format]
quote-style = "double"

[tool.pylint.main]
source-roots = ["src"]
ignore-patterns = ["test_.*\\.py"]

[tool.pylint.messages_control]
disable = ["C0114", "C0115", "C0116"]  # missing docstrings

[tool.mypy]
python_version = "3.11"
strict = true
warn_return_any = true
disallow_untyped_defs = true

[[tool.mypy.overrides]]
module = ["tests.*"]
disallow_untyped_defs = false

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
addopts = "-v --strict-markers"
```

---

## Project Structure

```
project/
├── src/
│   └── mypackage/
│       ├── __init__.py
│       ├── api/
│       │   ├── __init__.py
│       │   └── routes.py
│       ├── services/
│       │   ├── __init__.py
│       │   └── user_service.py
│       └── models/
│           ├── __init__.py
│           └── user.py
├── tests/
│   ├── conftest.py
│   └── test_user_service.py
├── pyproject.toml
└── README.md
```

---

## Poetry Projects

If the project uses Poetry:

```bash
# Add dependencies
poetry add requests

# Add dev dependencies
poetry add --group dev pytest

# Run commands
poetry run pytest
poetry run python script.py

# Install from lockfile
poetry install
```

---

## Pip Projects

If the project uses plain pip:

```bash
# Install dependencies
pip install -r requirements.txt
pip install -r requirements-dev.txt

# Run commands
python script.py
pytest
```

---

## Quick Reference: Tooling Violations

| Violation | Fix |
|-----------|-----|
| `pip install` in uv project | Use `uv add` |
| `python script.py` in uv project | Use `uv run python script.py` |
| Creating `pyproject.toml` manually | Use `uv init` |
| Missing `uv.lock` in git | Run `uv sync` and commit lock |
| Mixing package managers | Use only one (prefer uv) |
| `--group` missing for dev deps | Use `uv add --group dev pytest` |
