# Homebrew
eval "$(/opt/homebrew/bin/brew shellenv 2>/dev/null)"

# mise — runtime version manager
command -v mise >/dev/null 2>&1 && eval "$(mise activate bash)"

# Environment
{% for entry in devbox_shell.env %}
export {{ entry.name }}="{{ entry.value }}"
{% endfor %}

# PATH — prepend (high priority)
{% for p in devbox_shell.path_prepend %}
export PATH="{{ p }}:$PATH"
{% endfor %}

# PATH — append (low priority)
{% for p in devbox_shell.path_append %}
export PATH="$PATH:{{ p }}"
{% endfor %}

# PATH — conditional
{% for item in devbox_shell.path_conditional %}
[ -d "{{ item.check }}" ] && export PATH="{{ item.add }}:$PATH"
{% endfor %}

# Toolchain caches: redirect to sandbox-writable paths inside Claude Code
if [ -n "$CLAUDECODE" ]; then
  export GOCACHE="${TMPDIR}/go-build-cache"
  export GOMODCACHE="${TMPDIR}/go-mod-cache"
  export UV_CACHE_DIR="${TMPDIR}/uv-cache"
  export RUFF_CACHE_DIR="${TMPDIR}/ruff-cache"
  export MYPY_CACHE_DIR="${TMPDIR}/mypy-cache"
  export NPM_CONFIG_CACHE="${TMPDIR}/npm-cache"
fi
