---
- name: "Install Homebrew apps"
  community.general.homebrew:
    name:
      - opam
      - erlang
      - rustup
      - flutter
      - go
      - go-task
      - uv
      - kubectl
      - helm
      - orbstack
      - k9s
      - fzf
      - tmux
      - "node@18"
      - golangci-lint
      - luarocks # Needed by lazy.nvim
      - go-jsonnet
      - jsonnet-bundler
    state: present

- name: "Install Homebrew casks"
  community.general.homebrew_cask:
    name:
      - obsidian
      - goland
      - webstorm
      - intellij-idea
      - pycharm
      - ghostty
      - claude

      - freelens
      - zen
    state: present
    install_options: 'adopt'
    upgrade_all: false
  register: cask_secondary_result
  failed_when:
    - cask_secondary_result.failed is defined
    - cask_secondary_result.failed
    - '"already installed" not in cask_secondary_result.msg'

- name: "Install Claude Code CLI"
  community.general.npm:
    name: "@anthropic-ai/claude-code"
    global: true
    state: present

- name: "Init OCaml"
  ansible.builtin.command:
    cmd: opam init -y
    creates: "{{ lookup('ansible.builtin.env', 'HOME') }}/.opam"

- name: "Install necessary OCaml packages"
  ansible.builtin.command:
    cmd: opam install -y ocaml-lsp-server odoc ocamlformat utop
    # Using last binary to ensure that all expected packages are installed.
    creates: "{{ lookup('ansible.builtin.env', 'HOME') }}/.opam/default/bin/utop"
